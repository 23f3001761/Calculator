<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width,initial-scale=1" name="viewport"/>
  <title>Scientific Calculator - Minimal</title>
  <style>
    :root{
      --bg:#f4f6f8;
      --panel:#ffffff;
      --accent:#2b7cff;
      --muted:#6b7280;
      --light:#e6eefc;
      --danger:#ef4444;
      --shadow: 0 6px 18px rgba(20,20,30,0.06);
      --font: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      background:linear-gradient(180deg,var(--bg),#eef2f7);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      color:#111827;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .calc {
      width:420px;
      background:var(--panel);
      border-radius:12px;
      box-shadow:var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      user-select:none;
    }

    .display {
      padding:14px 16px 12px;
      background:linear-gradient(180deg,#fbfdff,#f7fbff);
      border-bottom:1px solid #eef2f7;
    }

    .expr {
      font-size:14px;
      color:var(--muted);
      min-height:18px;
      word-wrap:break-word;
    }

    .result {
      margin-top:6px;
      font-size:28px;
      font-weight:600;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    .kbd-hint {
      margin-top:6px;
      font-size:12px;
      color:#9aa4b2;
    }

    .pad {
      padding:12px;
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:10px;
      background:transparent;
      align-items:stretch;
    }

    button.btn {
      border:0;
      border-radius:8px;
      background:transparent;
      padding:14px 10px;
      font-size:16px;
      cursor:pointer;
      transition:all .12s ease;
      box-shadow:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      color:#111827;
      min-height:44px;
    }

    button.btn:hover { transform:translateY(-2px); }

    .btn.op { background:var(--light); color:var(--accent); }
    .btn.clear { background:#fff6f6; color:var(--danger); }
    .btn.eq { background:var(--accent); color:white; }
    .btn.num { background:transparent; color:#111827; }
    .btn.wide { grid-column: span 2; }

    .small {
      font-size:13px;
      color:var(--muted);
    }

    footer {
      padding:10px 12px;
      font-size:12px;
      color:var(--muted);
      text-align:center;
      background:transparent;
      border-top:1px solid #f1f5f9;
    }

    /* Responsive */
    @media (max-width:520px){
      .calc{ width:100%; max-width:92vw; }
      .result{font-size:26px}
    }
  </style>
</head>

<body>
  <div class="calc" id="calc">
    <div class="display" id="display">
      <div class="expr" id="expr" aria-label="Expression"></div>
      <div class="result" id="result" aria-live="polite">0</div>
      <div class="kbd-hint" id="hint">Trigonometry uses radians. Supported: + - * / ^, (), sin, cos, tan, asin, acos, atan, sqrt, ln, log, pi, e, abs, exp</div>
    </div>

    <div class="pad" id="pad-grid">
      <!-- Row 1: Functions -->
      <button class="btn op" data-value="sin(">sin</button>
      <button class="btn op" data-value="cos(">cos</button>
      <button class="btn op" data-value="tan(">tan</button>
      <button class="btn op" data-value="sqrt(">√</button>

      <!-- Row 2: Inverse and logs -->
      <button class="btn op" data-value="asin(">asin</button>
      <button class="btn op" data-value="acos(">acos</button>
      <button class="btn op" data-value="atan(">atan</button>
      <button class="btn op" data-value="log(">log</button>

      <!-- Row 3: Natural log, constants, power -->
      <button class="btn op" data-value="ln(">ln</button>
      <button class="btn op" data-value="pi">pi</button>
      <button class="btn op" data-value="e">e</button>
      <button class="btn op" data-value="^">^</button>

      <!-- Row 4: Numbers and division -->
      <button class="btn num" data-value="7">7</button>
      <button class="btn num" data-value="8">8</button>
      <button class="btn num" data-value="9">9</button>
      <button class="btn op" data-value="/">/</button>

      <!-- Row 5: Numbers and multiplication -->
      <button class="btn num" data-value="4">4</button>
      <button class="btn num" data-value="5">5</button>
      <button class="btn num" data-value="6">6</button>
      <button class="btn op" data-value="*">*</button>

      <!-- Row 6: Numbers and subtraction -->
      <button class="btn num" data-value="1">1</button>
      <button class="btn num" data-value="2">2</button>
      <button class="btn num" data-value="3">3</button>
      <button class="btn op" data-value="-">-</button>

      <!-- Row 7: Zero, decimal, percent, backspace -->
      <button class="btn num" data-value="0">0</button>
      <button class="btn num" data-value=".">.</button>
      <button class="btn op" data-value="%">%</button>
      <button class="btn" data-value="back" title="Backspace">⌫</button>

      <!-- Row 8: Parentheses, Clear, Equals -->
      <button class="btn" data-value="(">(</button>
      <button class="btn" data-value=")">)</button>
      <button class="btn clear" data-value="clear">C</button>
      <button class="btn eq" data-value="=">=</button>
    </div>
  </div>

  <footer>Minimal Scientific Calculator</footer>

  <!-- External library: math.js for safe evaluation -->
  <script src="https://cdn.jsdelivr.net/npm/mathjs@latest/dist/math.min.js"></script>

  <script>
    (function(){
      const exprEl = document.getElementById('expr');
      const resultEl = document.getElementById('result');
      const pad = document.getElementById('pad-grid');
      let current = '';
      let lastResult = 0;

      function formatResult(val){
        if (typeof val === 'number' && isFinite(val)) {
          // Show up to 12 significant digits, trim redundant zeros
          const s = val.toPrecision(12);
          const trimmed = s.replace(/(?:\.0+|(\.\d+?)0+)$/, '$1');
          // If in exponential form, keep it simple too
          return trimmed;
        }
        if (typeof val === 'string') return val;
        return 'Error';
      }

      function refreshDisplay(){
        exprEl.textContent = current.length ? current : '0';
        // Live result
        try {
          if (current.trim().length === 0) {
            resultEl.textContent = '0';
            lastResult = 0;
            return;
          }
          const res = math.evaluate(current);
          resultEl.textContent = formatResult(res);
          lastResult = res;
        } catch (e){
          // While typing, show Error only if truly invalid
          resultEl.textContent = 'Error';
        }
      }

      function appendValue(val){
        current += val;
        refreshDisplay();
      }

      function backspace(){
        current = current.slice(0, -1);
        refreshDisplay();
      }

      function clearAll(){
        current = '';
        refreshDisplay();
      }

      function handlePercent(){
        // Apply percent to the last number if possible
        const m = current.match(/(\d+(\.\d+)?)$/);
        if (m) {
          const last = m[1];
          current = current.slice(0, -last.length) + '(' + last + '/100)';
        } else {
          // Fallback: multiply whole expression by 0.01
          current = current + '*0.01';
        }
        refreshDisplay();
      }

      function evalEquals(){
        try {
          const res = math.evaluate(current || '0');
          current = String(res);
          refreshDisplay();
        } catch (e){
          resultEl.textContent = 'Error';
        }
      }

      // Button clicks
      pad.querySelectorAll('button.btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const val = btn.dataset.value;
          if (!val) return;
          switch (val) {
            case 'clear':
              clearAll();
              break;
            case 'back':
              backspace();
              break;
            case '=':
              evalEquals();
              break;
            case '%':
              handlePercent();
              break;
            default:
              // For special constants like pi/e or functions like sin(, we push as-is
              appendValue(val);
          }
        });
      });

      // Keyboard support
      window.addEventListener('keydown', (e) => {
        const k = e.key;
        if ((/^[0-9]$/.test(k)) || k === '.') {
          appendValue(k);
          e.preventDefault();
        } else if ('+-*/^()'.includes(k)) {
          appendValue(k);
          e.preventDefault();
        } else if (k === 'Enter' || k === '=') {
          evalEquals();
          e.preventDefault();
        } else if (k === 'Backspace') {
          backspace();
          e.preventDefault();
        } else if (k === 'Escape') {
          clearAll();
          e.preventDefault();
        } else if (k === '%') {
          handlePercent();
          e.preventDefault();
        }
      });

      // Initialize
      refreshDisplay();
    })();
  </script>
</body>
</html>